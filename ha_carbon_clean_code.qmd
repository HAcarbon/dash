---
title: "HAU Carbon"
logo: "images/nl_agridat_hex_tp.png"
format: dashboard
#server: shiny
date-modified: 2024-03-27
orientation: columns
expandable: false
theme: flatly_edited.scss
embed-resources: true
resources: "docs/HAcarbon_master_2023.xlsx"
---

```{r Dashboard set up, echo=FALSE}

source("master_scripts.R")


```

# Emissions

## Column {width="40%"}

### Row {title="summaryboxes" height="25%"}

```{r net emissions in 2022 value boxa}
bslib::value_box(
  title = h1(HTML("Net emissions<br>"),latest_year),
  value = my_comma(current_net_co2e),
   p(HTML("Kt CO<sub>2</sub>e")),
  theme = "warning"
  )

```

```{r net emissions reduction 21-22 value boxa}
bslib::value_box(
  title = h1(HTML("Net emission/kg output <br>", latest_year )),
  value = my_comma(latest_net_per_kg),
  p(HTML("Kt CO<sub>2</sub>e")),
  theme = "info"
  )

```

```{r net emissions reduction per kg}
bslib::value_box(
  title = h1(HTML("Net emissions/kg output reduction <br>", s_prev_year, "/", s_cur_year )),
  value = my_comma(net_per_kg_reduction),
  p(HTML("Kg CO<sub>2</sub>e/kg")),
  theme = "success"
  )

```

### Row {height="75%"}

```{r leafleta}
carbon_map
```

## Column {Width="60%"}

### Row {.tabset}

```{r ghg contributions graph}
#| title: Emissions by GHG type
#| fig-cap: The total annual kilotonnes of green house gas (GHG) emissions (based on GWP equivlaent calculations) produced per year on the Harper Adams Future Farm presenting the quantity of the four types of GHG recorded during teh carbon calculation. Colours represent different GHG types.Equivalent emissions were calculated using the [IPCC AR5 report](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 

carbon_data %>% 
  rename(direct = co2_direct_co2_kgco2e,
         indirect = co2_indirect_co2_kgco2e, 
         methane = methane_total_kgco2e,
         nitrous_oxide = nitrous_oxide_total_kgco2e) %>%
  pivot_longer(-c(results_id:lineitem_code),   names_to = "ghg_type", values_to = "values") %>% 
filter(ghg_type == "direct" | ghg_type == "indirect" | ghg_type == "methane" | ghg_type == "nitrous_oxide") %>% 
  filter(lineitem_code == "WHOLE_FARM") %>% 
  # group_by(year, ghg_type) %>%
  # summarise(emission = (sum(values))/1000) %>% 
mutate(emission = values/1000000) %>% 
  ggplot(aes(x = as.factor(year), y = emission, fill = ghg_type))+
  geom_bar(position = "stack", stat = "identity") +
  scale_fill_manual(
    labels = c("Direct carbon", "Indirect carbon", "Methane", "Nitrous oxide"),
    limits = c("direct", "indirect", "methane", "nitrous_oxide"),
    values = ghgpal) +
    # ylab(bquote(atop("Nitrous Oxide Emissions ", "(tonnes"~CO[2]~"e)"))) +
  ylab(bquote(atop(bold(.(GHG~Emissions)), (bold(.(Kt~CO[2]~e)))))) +
  labs(
       x = "Year", 
       fill = "GHG type") + 
  theme_bw() +
  theme_m.tl
  
```

```{r direct carbon graph}
#| title: Direct Carbon
#| fig-cap: The total annual kilotonnes of direct (Scope 1) carbon dioxide emissions produced from the Harper Adams Future Farm for the years 2022 to 2023. Colours indicate the contribution of each sector to the total emission output. Equivalent emissions were calculated using the [IPCC AR5 report](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 

carbon_data %>%
  mutate(direct_carbon_tot = co2_direct_co2_kgco2e/1000000) %>%
   filter(lineitem_code != "WHOLE_FARM") %>%
ggplot( aes(x = as.factor(year), y = direct_carbon_tot, fill = lineitem_code)) +
  geom_bar(position="stack", stat="identity") +
    scale_fill_manual(
    labels = c("Dairy", "Beef", "Pigs", "Sheep", "Oilseed Rape"),
    limits = c("DAIRY", "BEEF", "PIGS", "SHEEP", "C6"),
    values = sector_pal) +
  ylab(bquote(atop(bold(.(Direct~Carbon~Emissions)), (bold(.(Kt~CO[2]~e)))))) +
  # ylab(bquote(atop("Direct Carbon Emissions ", "(tonnes"~CO[2]~"e)"))) +
  labs(
       x = "Year",
       fill = "Sector") + 
  theme_bw()+
  theme_m.tl
```

```{r indirect carbon graph}
#| title: Indirect Carbon 
#| fig-cap: The total annual kilotonnes of indirect (Scope 2) carbon dioxide emissions produced from the Harper Adams Future Farm for the years 2022 to 2023. Colours indicate the contribution of each sector to the total emission output. Equivalent emissions were calculated using the [IPCC AR5 report](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 


carbon_data %>%
  mutate(indirect_carbon_tot = co2_indirect_co2_kgco2e/1000000) %>%
   filter(lineitem_code != "WHOLE_FARM") %>%
ggplot( aes(x = as.factor(year), y = indirect_carbon_tot, fill = lineitem_code)) +
   geom_bar(position="stack", stat="identity") +
    scale_fill_manual(
    labels = c("Dairy", "Beef", "Pigs", "Sheep", "Oilseed Rape"),
    limits = c("DAIRY", "BEEF", "PIGS", "SHEEP", "C6"),
    values = sector_pal) +
  # ylab(bquote(atop("Indirect Carbon Emissions ", "(tonnes"~CO[2]~"e)"))) +
  ylab(bquote(atop(bold(.(Indirect~Carbon~Emissions)), (bold(.(Kt~CO[2]~e)))))) +
  labs( 
        x = "Year",
        fill = "Sector") + 
  theme_bw()+
  theme_m.tl
```

```{r methane graph}
#| title: Methane
#| fig-cap: The total annual kilotonnes of methane as carbon dioxide equivalent emissions produced from the Harper Adams Future Farm for the years 2022 to 2023. Colours indicate the contribution of each sector to the total emission output. Equivalent emissions were calculated using the [IPCC AR5 report](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 


carbon_data %>%
  mutate(methane = methane_total_kgco2e/1000000) %>%
   filter(lineitem_code != "WHOLE_FARM") %>%
ggplot( aes(x = as.factor(year), y = methane, fill = lineitem_code)) +
   geom_bar(position="stack", stat="identity") +
    scale_fill_manual(
    labels = c("Dairy", "Beef", "Pigs", "Sheep", "Oilseed Rape"),
    limits = c("DAIRY", "BEEF", "PIGS", "SHEEP", "C6"),
    values = sector_pal) +
  # ylab(bquote(atop("Methane Emissions ", "(tonnes"~CO[2]~"e)"))) +
  ylab(bquote(atop(bold(.(Methane~Emissions)), (bold(.(Kt~CO[2]~e)))))) +
  labs(
        x = "Year",  
        fill = "Sector") + 
  theme_bw()+
  theme_m.tl
```

```{r nitrous oxide graph}
#| title: Nitrous Oxide
#| fig-cap: The total annual kilotonnes of nitrous oxide as carbon dioxide equivalent emissions produced from the Harper Adams Future Farm for the years 2022 to 2023. Colours indicate the contribution of each sector to the total emission output. Equivalent emissions were calculated using the [IPCC AR5 report](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 

carbon_data %>%
  mutate(nitrous_oxide = nitrous_oxide_total_kgco2e/1000000) %>%
   filter(lineitem_code != "WHOLE_FARM") %>%
ggplot( aes(x = as.factor(year), y = nitrous_oxide, fill = lineitem_code)) +
   geom_bar(position="stack", stat="identity") +
    scale_fill_manual(
    labels = c("Dairy", "Beef", "Pigs", "Sheep", "Oilseed Rape"),
    limits = c("DAIRY", "BEEF", "PIGS", "SHEEP", "C6"),
    values = sector_pal) +
    # ylab(bquote(atop("Nitrous Oxide Emissions ", "(tonnes"~CO[2]~"e)"))) +
  ylab(bquote(atop(bold(.(Nitrous~Oxide~Emissions)), (bold(.(Kt~CO[2]~e)))))) +
  labs(
       x = "Year", 
       fill = "Sector") + 
  theme_bw() +
  theme_m.tl


```

# Biogenic & Themorgenic Emissions

## Column {width="40%"}

### Row {height="25%"}

```{r }
bslib::value_box(
  title = h1(HTML("Total thermogenic emissons"),latest_year),
  value = my_comma(tot_thermo_current),
  p(HTML("Kt CO<sub>2</sub>e")),
  theme = "warning"
  )
```

```{r }
bslib::value_box(
  title = h1(HTML("Total biogenic emissons"),latest_year),
  value = my_comma(tot_bio_current),
  p(HTML("Kt CO<sub>2</sub>e")),
  theme = "info"
  )

```

```{r }
bslib::value_box(
  title = h1(HTML("Total other emissons"),latest_year),
  value = my_comma(tot_other_current),
  p(HTML("Kt CO<sub>2</sub>e")),
  theme = "success"
  )

```

### Row {height="75%"}

::: panel-tabset
## Definitions

The term **biogenic** refers to the emissions that come from **natural** **sources**, that were originally removed from the atmosphere and would eventually cycle back to the atmosphere due to degradation.

The term **thermogenic** refers to the emissions produced by the effect of heat and pressure (on fossil fuels such as oil, coal, and natural gas) from **anthropogenic activity**.

## Contributing sources

| Emission source                                   |   GHG group    | Emission type  |
|--------------------------------|:------------------:|:------------------:|
| Enteric fermentation                              |    Methane     |    Biogenic    |
| Manure Management                                 |    Methane     |    Biogenic    |
| Diesel                                            | Carbon Dioxide |  Thermogenic   |
| Electricity                                       | Carbon Dioxide |  Thermogenic   |
| Other fuels                                       | Carbon Dioxide |  Thermogenic   |
| Renewable electricity                             | Carbon Dioxide |  Thermogenic   |
| Renewable heat                                    | Carbon Dioxide |  Thermogenic   |
| Fertiliser                                        | Carbon Dioxide |  Thermogenic   |
| Lime                                              | Carbon Dioxide |  Thermogenic   |
| Feed                                              | Carbon Dioxide |  Thermogenic   |
| Bedding                                           | Carbon Dioxide |  Thermogenic   |
| Pesticides                                        | Carbon Dioxide |  Thermogenic   |
| Waste plastic/packaging                           | Carbon Dioxide |  Thermogenic   |
| Disposal of carcasses                             | Carbon Dioxide |  Thermogenic   |
| Transport                                         | Carbon Dioxide |  Thermogenic   |
| Inorganic & imported organic manure input to soil | Nitrous Oxide  | Combination \* |
| Grazing deposition                                | Nitrous Oxide  | Combination \* |
| Manure management & organic manure input to soil  | Nitrous Oxide  | Combination \* |
| Crop N residues                                   | Nitrous Oxide  | Combination \* |

: {.striped .hover}

*Note: \* Due to the current scientific uncertainty regarding the classification of nitrous oxide emissions as biogenic or thermogenic, the emission sources which fall under nitrous oxide are currently identified as a 'combination'.*
:::

## Column {.tabset width="60%"}

```{r total contribution whole farm}
#| title: Total by Source type
#| fig-cap: The total annual kilotonnes of carbon dioxide equivalent emissions produced from the Harper Adams Future Farm for the years 2022 to 2023 grouped by emisson source type. Colours indicate the contribution of each source type to the total emission output. Equivalent emissions were calculated using the [IPCC AR5 report](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 

source_data_wf %>% 
  ggplot(aes(x=as.factor(year), y = co2e_kT_type_tot, fill = source_type)) +
  geom_bar(stat="identity", position = "stack") +
      scale_fill_manual(
    labels = emission_source_labels,
    limits = emission_source_limits,
    values = emission_source_pal) +
  ylab(bquote(atop(bold(.(Carbon~Emissions)), (bold(.(Kt~CO[2]~e)))))) +
  labs(
       x = "Year", 
       fill = "Emission source type",
       colour ="Emission source type") + 
  theme_bw() +
  theme_m.tl


```

```{r thermo per sector (bio and thermo)}
#| title: Thermogenic by Sector
#| fig-cap: The total thermogenic emissions produced from the Harper Adams Future Farm for the years 2022 to 2023. Colours indicate the contribution of each sector to the thermogenic sources of emissions. Equivalent emissions were calculated using the [IPCC AR5 report](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 

source_data_sector %>%
  filter(lineitem_code == "DAIRY" | lineitem_code == "BEEF" | lineitem_code == "SHEEP" | lineitem_code == "PIGS" | lineitem_code =="C6") %>%
  filter(source_type=="Thermogenic") %>%
    ggplot(aes(x=as.factor(year), y = co2e_kt_sect)) +
  geom_bar(stat="identity", position = "stack", aes(fill =lineitem_code)) +
    scale_fill_manual(
    labels = c("Dairy", "Beef", "Pigs", "Sheep", "Oilseed Rape"),
    limits = c("DAIRY", "BEEF", "PIGS", "SHEEP", "C6"),
    values = sector_pal) +
  ylab(bquote(atop(bold(.(Proportion~of~carbon~emissions)), (bold(.(Kt~CO[2]~e)))))) +
  labs(
       x = "Year", 
       fill = "Sector") + 
  theme_bw() +
  theme_m.tl
  
```

```{r}
#| title: Biogenic by Sector
#| fig-cap: The total biogenic emissions produced from the Harper Adams Future Farm for the years 2022 to 2023. Colours indicate the contribution of each sector to the biogenic sources of emissions. Equivalent emissions were calculated using the [IPCC AR5 report](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 

source_data_sector %>%
  filter(lineitem_code == "DAIRY" | lineitem_code == "BEEF" | lineitem_code == "SHEEP" | lineitem_code == "PIGS" | lineitem_code =="C6") %>%
  filter(source_type=="Biogenic") %>%
    ggplot(aes(x=as.factor(year), y = co2e_kt_sect)) +
  geom_bar(stat="identity", position = "stack", aes(fill =lineitem_code)) +
    scale_fill_manual(
    labels = c("Dairy", "Beef", "Pigs", "Sheep", "Oilseed Rape"),
    limits = c("DAIRY", "BEEF", "PIGS", "SHEEP", "C6"),
    values = sector_pal) +
  ylab(bquote(atop(bold(.(Proportion~of~carbon~emissions)), (bold(.(Kt~CO[2]~e)))))) +
  labs(
       x = "Year", 
       fill = "Sector") + 
  theme_bw() +
  theme_m.tl
```

# Detailed Emission Sources

## Column {width="40%"}

### Row {height="25%"}

```{r Total co2e produced in 2022 value box}
bslib::value_box(
  title = h1(HTML("Total CO<sub>2</sub>e<br>"),latest_year),
  value = my_comma(tot_co2e_current),
  p(HTML("Kt CO<sub>2</sub>e")),
  theme = "warning"
  )
```

```{r net emissions in 2022 value box}
bslib::value_box(
  title = h1(HTML("Net emissions<br>"),latest_year),
  value = my_comma(current_net_co2e),
   p(HTML("Kt CO<sub>2</sub>e")),
  theme = "info"
  )

```

```{r net emissions reduction 21-22 value box}
bslib::value_box(
  title = h1(HTML("Net emission reduction <br>", s_prev_year, "/", s_cur_year )),
  value = my_comma(carbon_reduction_current_previous),
  p(HTML("Kt CO<sub>2</sub>e")),
  theme = "success"
  )

```

### Row {height="75%"}

```{r leaflet}

 carbon_map

```

## Column {.tabset width="60%"}

```{r total GHG emission graph}
#| title: Emissons by Livestock Sector #| fig-cap: The total annual kilotonnes of carbon dioxide equivalent emissions produced from the Harper Adams Future Farm for the years 2022 to 2023. Colours indicate the contribution of each sector to the total emission output. Equivalent emissions were calculated using the IPCC AR5 guidelines on Global Warming Potential (GWP) equivalents.}

carbon_data %>% mutate(carbon_equiv_tot = total_co2e_emissions_from_farming_kgco2e/1000000) %>% filter(lineitem_code != "WHOLE_FARM") %>% ggplot( aes(x = as.factor(year), y = carbon_equiv_tot, fill = lineitem_code)) + geom_bar(position="stack", stat="identity") + scale_fill_manual( labels = c("Dairy", "Beef", "Pigs", "Sheep", "Oilseed Rape"), limits = c("DAIRY", "BEEF", "PIGS", "SHEEP", "C6"), values = sector_pal) + ylab(bquote(atop(bold(.(TotalCarbonEquivalent~Emissions)), (bold(.(KtCO[2]~e)))))) + labs( x = "Year", fill = "Sector") + theme_bw()+ theme_m.tl
```

```{r}
#| title: Dairy
#| fig-cap: The total annual GHG emissions produced from the dairy sector of the Harper Adams Future Farm for the years 2022 to 2023. Colours indicate the individual sources of direct carbon emissions. Equivalent emissions were calculated using the [IPCC AR5](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 
 

c_data %>% 
       filter(lineitem_code == "DAIRY") %>%
    filter(ghg_summary == "measure") %>% 
    filter(ghg_name_detail != "Carbon seq") %>% 
    ggplot(aes(x = as.factor(year), y = values/1000000, fill = variables)) +
    geom_bar(position = "stack", stat = "identity") +
     scale_fill_manual(
    labels = c(detail_labels),
     limits = c(detail_limits),
       values = detail_ghg_pal) +
     ylab(bquote(atop(bold(.(GHG~Emissions~(Kt~CO[2]~e)))))) +
    labs( x = "Year", fill = "Emissions source")+
    facet_wrap(~ghg_name_detail)+ 
  theme_bw()+
  theme_m.rl

```

```{r}
#| title: Beef
#| fig-cap: The total annual GHG emissions produced from the beef sector of the Harper Adams Future Farm for the years 2022 to 2023. Colours indicate the individual sources of direct carbon emissions. Equivalent emissions were calculated using the [IPCC AR5](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 
c_data %>% 
       filter(lineitem_code == "BEEF") %>%
    filter(ghg_summary == "measure") %>% 
    filter(ghg_name_detail != "Carbon seq") %>% 
    ggplot(aes(x = as.factor(year), y = values/1000000, fill = variables)) +
    geom_bar(position = "stack", stat = "identity") +
     scale_fill_manual(
    labels = c(detail_labels),
     limits = c(detail_limits),
       values = detail_ghg_pal) +
    ylab(bquote(atop(bold(.(GHG~Emissions~(Kt~CO[2]~e)))))) +
    labs( x = "Year", fill = "Emissions source")+
    facet_wrap(~ghg_name_detail)+ 
  theme_bw()+
  theme_m.rl


```

```{r}
#| title: Sheep
#| fig-cap: The total annual GHG emissions produced from the sheep sector of the Harper Adams Future Farm for the years 2022 to 2023. Colours indicate the individual sources of direct carbon emissions. Equivalent emissions were calculated using the [IPCC AR5](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 

c_data %>% 
       filter(lineitem_code == "SHEEP") %>%
    filter(ghg_summary == "measure") %>% 
    filter(ghg_name_detail != "Carbon seq") %>% 
    ggplot(aes(x = as.factor(year), y = values/1000000, fill = variables)) +
    geom_bar(position = "stack", stat = "identity") +
     scale_fill_manual(
    labels = c(detail_labels),
     limits = c(detail_limits),
       values = detail_ghg_pal) +
    ylab(bquote(atop(bold(.(GHG~Emissions~(Kt~CO[2]~e)))))) +
    labs( x = "Year", fill = "Emissions source")+
    facet_wrap(~ghg_name_detail)+ 
  theme_bw()+
  theme_m.rl

```

```{r}
#| title: Pigs
#| fig-cap: The total annual GHG emissions produced from the pigs sector of the Harper Adams Future Farm for the years 2022 to 2023. Colours indicate the individual sources of direct carbon emissions. Equivalent emissions were calculated using the [IPCC AR5](https://ar5-syr.ipcc.ch/ipcc/ipcc/resources/pdf/IPCC_SynthesisReport.pdf) guidelines on Global Warming Potential (GWP) equivalents. 

c_data %>% 
       filter(lineitem_code == "PIGS") %>%
    filter(ghg_summary == "measure") %>% 
    filter(ghg_name_detail != "Carbon seq") %>% 
    ggplot(aes(x = as.factor(year), y = values/1000000, fill = variables)) +
    geom_bar(position = "stack", stat = "identity") +
     scale_fill_manual(
    labels = c(detail_labels),
     limits = c(detail_limits),
       values = detail_ghg_pal) +
    ylab(bquote(atop(bold(.(GHG~Emissions~(Kt~CO[2]~e)))))) +
    labs( x = "Year", fill = "Emissions source")+
    facet_wrap(~ghg_name_detail) + 
  theme_bw()+
  theme_m.rl

```



# Data

## Column {.tabset width="70%"}

```{r}
#| title: Data 
datatable(carbon_data %>%
            select(-farm_area),
          filter = list(position = 'top', clear = FALSE),
          extensions = 'Buttons',
          options = list(dom = 'Bfrtip',
                         buttons = c('copy'))) %>%
  formatRound(columns = c(5:72), digits = 2, mark ="", dec.mark = ".")
```

```{r}
#| title: Data dictionary - variables

datatable(data_dict, filter = list(position = 'topleft', clear = FALSE),
          extensions = 'Buttons',
          options = list(dom = 'Bfrtip',
                         buttons = c('copy')))

```

```{r}
#| title: Data dictionary - LineItem code

datatable(other_dict, filter = list(position = 'topleft', clear = FALSE),
          extensions = 'Buttons',
          options = list(dom = 'Bfrtip',
                         buttons = c('copy')))

```

## Column {width="30%"}

### Row {height="25%"}

::: {.card title="Download the data"}
[Download carbon data excel file](https://github.com/HAcarbon/dash/raw/main/docs/data/HA_carbon_emission_data.xlsx)
:::

### Row {.tabset height="75%"}

::: {.card title="Information"}
This data comprise the output results from the [AgreCalc Farm Carbon Calculator](https://www.agrecalc.com/) for the years 2022 to 2023. Input data was collated from across the farm for each year.

**Comments**

-   Due to the current format of the output provided by Agrecalc, there are limitations on the knowledge relating to certain assumptions or calculations which were made to results in the current presented data. Therefore data display is somewhat limited.

-   Original data is in kg CO~2~e. Data presented in this dashboard has been converted to Kilotonnes (Kt) CO~2~e with the except of data presented in the map which is in tonnes (t) CO~2~e.
:::
